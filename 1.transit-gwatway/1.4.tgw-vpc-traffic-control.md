---
description: 'Update : 2020-02-24'
---

# 1.4 TGW 기반 VPC 트래픽 제어

### AWS Networking의 이해

["1.3 TGW 구성" ](1.3.tgw-check.md)을 마치고, VPC간 통신이 되지 않으며 IT OCTANK VPC의 EC2 인스턴스를 제외한 모든 VPC의 EC2 인스턴스가 외부로 네트워크가 되지 않는 것을 확인하였습니다.   
이제 그 이유를 살펴 보고 , 기업에서 효과적으로 VPC간의 트래픽을 제어하기 위한 방법을 살펴 보겠습니다.

먼저 AWS Networking을 이해할 필요가 있습니다.  
우리의 랩 구성은 현재 아래와 같이 논리적으로 구성되어 있습니다.  
IT OCTANK와 A OCTANK 구성을 살펴 보겠습니다.

![\[&#xADF8;&#xB9BC; 1.4.1 - VPC-TGW &#xB124;&#xD2B8;&#xC6CC;&#xD06C; &#xAD6C;&#xC131;\]](../.gitbook/assets/1.4.-topology.png)

A OCTANK VPC에서 EC2 Instance 10.11.14.100의 서버 IT OCTANK VPC의 EC2 Instance 10.0.14.100 사이에 트래픽이 전송되지 않는 이유는  상호간에 VPC Private Route Table에 관련 정보가 없기 때문입니다. 아래 그림은 각 VPC에서 Private Route Table 에서의 경로 정보입니다.  
 IT OCTANK VPC에서 EC2 Instance가 www.aws.com 으로 정상적으로 PING 응답이 되는 이유는 0.0.0.0/0 에 대한 경로가 NAT Gateway 로 지정되어 있기 때문입니다.

![\[&#xADF8;&#xB9BC; 1.4.2 - A OCTANK Private Route Table &#xAD6C;&#xC131;\]](../.gitbook/assets/1.4.aoctank_privatert_before%20%281%29.png)

![\[&#xADF8;&#xB9BC; 1.4.3 - IT OCTANK Private Route Table &#xAD6C;&#xC131;\]](../.gitbook/assets/1.4.itoctank_private_rt1.png)

\[그림 1.4.1\] 3에서 처럼 Transit Gateway에 연결된 A OCTANK VPC를 위한 Red Route Table에는 0.0.0.0/0 에 대한 경로가 이미 IT OCTANK VPC로 Static으로 선언 되어 있습니다. 

{% hint style="info" %}
["1.3 TGW 구성"](1.3.tgw-check.md)에서 VPC간 통신이 되지 않았던 이유는, TGW 의 구성은 Cloudformation에서 모두 라우팅 구성이 되어 있지만, 각 VPC에서 Route Table에 경로가 없기 때문입니다. 실제 필드에서도 TGW는 모두 구성하여 연결하고, 필요에 따라 각 VPC에서는 Route Table에만 추가하면 원하는 데로 트래픽 경로를 처리할 수 있게 됩니다.
{% endhint %}

이제 A OCTANK와 IT OCTANK의 Private Route Table에서 Table을 추가하고, 각 EC2에서 다시 트래픽이 정상적으로 동작하는지를 확인해 봅니다.

  






### TGW기  VPC 트래픽 제어


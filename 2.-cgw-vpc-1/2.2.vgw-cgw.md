---
description: 'Update : 2020-02-27'
---

# 2.2 VGW-CGW 연결 구성

### AWS Cloud9 기본 설

CGW\(Customer Gateway\)에 LAB에서 처럼 Public IP로 할당이 가능하지만, 다른 EC2 처럼 사설 IP로 연결 구성 할 수도 있습니다. 이 랩에서는 AWS Cloud9을 통해 기본 제공되는 Cisco CSR1KV 라우터의 기본 템플릿을 손쉽게 변경해서 배포하는 방법을 제공합니다.

먼저 Cloud 9을 생성합니다. \(AWS Cloud9 서비스에서 아래와 같이 구성을 시작합니다.\)

![\[&#xADF8;&#xB9BC; 2.2.1 Cloud9 &#xC0DD;&#xC131;\]](../.gitbook/assets/2.1.13.c9.png)

IDE환경의 이름을 정의합니다.

![\[&#xADF8;&#xB9BC; 2.2.2 IDE &#xC774;&#xB984; &#xC815;&#xC758;\]](../.gitbook/assets/2.1.14.c9.png)

IDE 환경을 아래와 같이 구성합니다.

![\[&#xADF8;&#xB9BC; 2.2.3 Cloud9 &#xD658;&#xACBD;&#xAD6C;&#xC131; 1\]](../.gitbook/assets/2.1.15.c9.png)

![\[&#xADF8;&#xB9BC; 2.2.4 Cloud9 &#xD658;&#xACBD;&#xAD6C;&#xC131; 2\]](../.gitbook/assets/2.1.16.c9.png)

생성 완료 이후 몇 분후에 아래와 같은 화면이 제공됩니다.

![\[&#xADF8;&#xB9BC; 2.2.5 Cloud 9 &#xCF58;&#xC194; &#xD654;&#xBA74;\]](../.gitbook/assets/2.2.5.c9.png)

이제 CGW를 템플릿 기반으로 간단하게 구성하기 위해 다음과 같은 단계를 수행합니다.  
먼저 ["1.2.TGW를 위한 VPC 구성"](../1.transit-gwatway/1.2.tgw-vpc.md#cloudformation-vpc)에서 소개된 git을 Cloud9 콘솔로 Clone합니다.

```text
git clone https://github.com/whchoi98/TGW_CF.git
```

CGW로 접속할 때 사용하는 KeyPem을 Cloud9으로 복사합니다.  
좌측 환경 패널로 현재 KeyPem파일을 Drag and Drop으로 아래에 생성된 디렉토리로 끌어 다 놓습니다.

```text
mkdir ./aws_key
mv ./aws_key/whchoi02.pem ~/.ssh/whchoi02.pem
chmod 400 ~/.ssh/whchoi02.pem
```

![\[&#xADF8;&#xB9BC; 2.2.5 Cloud 9 &#xD658;&#xACBD; &#xAD6C;&#xC131;\]](../.gitbook/assets/2.2.6.c9.png)

git에서 복제한 파일 중 랩에서 사용되는 hostfile을 /etc/hosts 파일로 복제합니다.  
\(랩을 진행하는데 필수 단계는 아닙니다.\)

```text
sudo cat hostfile >> /etc/hosts
more /etc/hosts
```

이제 Cloud9에서 직접 CGW에 접속해서 작업을 할 것입니다.  
여기에서는 2개의 사전에 구성된 Shell Script를 통해서 Cisco CSR1KV 를 자동으로 구성할 것입니다.

### TGW에 VGW 구성하기

앞서 ["2.1 CGW VPC구성"](2.1.cgw-vpc.md) 에서 Cloudformation을 통해 D OCTANK VPC와 필요한 자원, CGW등을 구성하였습니다. 이제 TGW를 구성하고 VGW 설정을 하겠습니다.

![\[&#xADF8;&#xB9BC; 2.2.6 VPC Dashboard&#xC5D0;&#xC11C; Transit Gateway-Create Transit Gateway Attachment &#xC120;&#xD0DD;\]](../.gitbook/assets/2.2.7.creat_tgw_attach.png)

\[그림2.2.7\]에서 현재 사용 중인 TGW를 선택하고, Attachment Type은 VPN을 선택합니다.  
VPN Attachment는 ["2.1 CGW VPC"](2.1.cgw-vpc.md#cloudformation-vpc) 구성에서 Cloudformation으로 생성한 CGW를 선택합니다.   
또한 Routing은 BGP를 선택합니다.

![\[2.2.7 TGW Attachment &#xC124;&#xC815;1\]](../.gitbook/assets/2.2.8.creat_tgw_attach.png)

Tunnel Options에서는 2개의 터널과 터널 연결을 위한 Pre-shared Key값을 설정합니다.  
이미 git 에서 복제한 CGW 인 CSR1KV 라우터에 동일한 서브넷과 Pre-shared Key값이 Template으로 설정되어 있습니다. 따라서 반드시 Tunnel 번호 및 서브넷, Pre-shared Key값이 같아야 합니다.

![\[2.2.8 TGW Attachment &#xC124;&#xC815;2\]](../.gitbook/assets/2.2.9.creat_tgw_attach.png)

설정이 완료되면 아래와 같이 새로운 Attachment가 생성되고 "Pending" 상태가 되고 , 잠시 후 "available"상태로 변경됩니다. 수 분의 시간이 걸릴 수 있습니다.

![\[2.2.9 TGW Attachment &#xC124;&#xC815; &#xD6C4; &#xD654;&#xBA74;\]](../.gitbook/assets/2.2.10.creat_tgw_attach.png)



### Cloud9에서 CGW구성하기




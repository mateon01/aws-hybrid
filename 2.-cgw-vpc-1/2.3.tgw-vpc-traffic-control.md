---
description: 'Update : 2020-02-27'
---

# 2.3 TGW 기반 CGW 트래픽제어

### TGW 기반 CGW연동 이해

앞서 "2.2 VGW-CGW 연결구성" 에서 Transit Gateway에 D OCTANK CGW 연결구성을 완료했습니다.  
D OCTANK Private Subnet에 위치한 EC2 인스턴스에서 네트워크를 점검해 보면 아래와 같습니다.

```text
[ec2-user@ip-10-1-8-100 TGW_CF]$ ./pingshell.sh
Fri Feb 28 02:05:11 UTC 2020
node www.aws.com is up
node ITSVR-A is down
node ITSVR-B is down
node ASVR-A is down
node ASVR-B is down
node BSVR-A is down
node BSVR-B is down
node CSVR-A is down
node CSVR-B is down
node DSVR-A is up
node DSVR-B is up
node FSVR-A is down
node FSVR-B is down
node ZSVR-A is down
node ZSVR-B is down
```

외부 네트워크와 내부 Private Subnet EC2 간의 네트워크를 제외하고는 정상적으로 통신이 이뤄지지 않는 것을 확인할 수 있습니다. 외부 네트워크는 NAT Gateway를 통해, Internet Gateway를 사용하기 때문에 TGW와는 관계가 없습니다.

아래 구성을 보면 쉽게 이해할 수 있습니다.

![\[&#xADF8;&#xB9BC; 2.3.1 IT OCTANK , D OCTANK, Transit Gateway &#xB77C;&#xC6B0;&#xD305; &#xD1A0;&#xD3F4;&#xB85C;&#xC9C0;\]](../.gitbook/assets/2.1.0.topology%20%281%29.png)

\[그림 2.3.1\] Transit Gateway Green Route Table에는 10.1.0.0/16에 대한 라우팅 테이블이 없습니다.  
이렇게 되면 IT OCTANK EC2는 D OCTANK의 라우팅 경로를 알 수 없습니다.  
\[VPC\] - \[Transit Gateway\] - \[Transit Gateway Route Tables\] - \[Green Route Table\]을 선택하여 , D OCTANK VPC CIDR 주소를 추가합니다.

![\[&#xADF8;&#xB9BC; 2.3.2 Green Route Table&#xC5D0; D OCTANK CIDR &#xCD94;&#xAC00;\]](../.gitbook/assets/2.3.2.tgw_green_rt.png)

![\[&#xADF8;&#xB9BC; 2.3.2 Green Route Table &#xD655;&#xC778;\]](../.gitbook/assets/2.3.3.tgw_green_rt.png)

이제 다시 DC OCTANK EC2 Instance에서 네트워크를 확인합니다.  
정상적으로 IT OCTANK EC2 인스턴스로 통신이 되는 지 확인 할 수 있습니다.

```text
[ec2-user@ip-10-1-8-100 TGW_CF]$ ./pingshell.sh
Fri Feb 28 02:38:47 UTC 2020
node www.aws.com is up
node ITSVR-A is up
node ITSVR-B is up
node ASVR-A is down
node ASVR-B is down
node BSVR-A is down
node BSVR-B is down
node CSVR-A is down
node CSVR-B is down
node DSVR-A is up
node DSVR-B is up
node FSVR-A is down
node FSVR-B is down
node ZSVR-A is down
node ZSVR-B is down
```

### TGW 기반 Traffic 제어










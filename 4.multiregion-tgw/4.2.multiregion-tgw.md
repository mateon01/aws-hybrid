---
description: 'Update : 2020-02-29'
---

# 4.2 Multiregion VPC 연결 구성 2

"4.1 MultiRegion VPC 연결구성 2"에서는 서로 다 계정의 환경에서 서로 다른 Region의 Transit Gateway Peering을 알아봅니다.

아래 \[그림 4.2.1\]은 "4.2 MultiRegion TGW 구성"에서 구성할 랩 구성입니다.

![\[&#xADF8;&#xB9BC; 4.2.1 MultiRegion VPC &#xAD6C;&#xC131;&#xB3C4;\]](../.gitbook/assets/4.1.1.lab_topology%20%281%29.png)

### 다른 계정/ 다른 리전에서 VPC 생성하

\[그림 4.2.1\] 에서 처럼 Account \(계정\)이 다르고 US-WEST-2 리전 환경을 사용하는 O OCTANK VPC 를 Cloudformation Stack으로 생성합니다.  
해당 Cloudformation Stack을 통해서 TGW, EC2, Subnet, Route Table, VPC Endpoint , SSM IAM Role, IGW, NAT G.W, EIP , Security Group 등이 자동으로 생됩니다.

**1.US-WEST-2 Region을 선택하고 , Cloudformation을 통해서 Stack을 생성합니다.**

\[Cloudformation\] - \[Stacks\] - \[Create Stack\]

![\[&#xADF8;&#xB9BC; 4.2.2 Cloudformation Stack &#xC0DD;&#xC131;1\]](../.gitbook/assets/4.2.2.cloudformation1.png)

![\[&#xADF8;&#xB9BC; 4.2.3 Cloudformation Stack &#xC0DD;&#xC131;2\]](../.gitbook/assets/4.2.3.cloudformation2%20%281%29.png)

![\[&#xADF8;&#xB9BC; 4.2.4 Cloudformation Stack &#xC0DD;&#xC131;3\]](../.gitbook/assets/4.2.4.cloudformation3.png)

![\[&#xADF8;&#xB9BC; 4.2.5 Cloudformation Stack &#xC0DD;&#xC131;4\]](../.gitbook/assets/4.2.5.cloudformation4.png)

**2.Cloudformation을 통해 생성된 VPC 자원을 확인합니다.**

\[VPC\] - \[Subnet\]

![\[&#xADF8;&#xB9BC; 4.2.6 O OCTANK VPC &#xC790;&#xC6D0; &#xC0DD;&#xC131; &#xD655;&#xC778;\]](../.gitbook/assets/4.2.6.ooctank_subnet_check%20%281%29.png)

**3.Cloudformation을 통해 생성된 Transit Gateway자원을 확인합니다.**

\[VPC\] - \[Transit Gateway\]

![\[&#xADF8;&#xB9BC; 4.1.7 O OCTANK Transit Gateway &#xC0DD;&#xC131; &#xD655;&#xC778;\]](../.gitbook/assets/4.2.7.ooctank_tgw_check.png)

### Region Transit Gateway 구성 및 EC2 확인

**1.US-WEST-2 의 O OCTANK Transit Gateway Attachment를 구성합니다.**

\[US-WEST-2\] - \[VPC\] - \[Transit Gateway\] - \[ Transit Gateway Attachment\]

![\[&#xADF8;&#xB9BC; 4.1.8 O OCTANK Transit Gateway Attachment &#xAD6C;&#xC131;\]](../.gitbook/assets/4.2.8.ooctank_tgw_attachment.png)

**2.US-WEST-2 의 O OCTANK Transit Gateway Attachment를 Association합니다.**

\[VPC\] - \[Transit Gateway\] - \[Transit Gateway Attachments\]

![\[&#xADF8;&#xB9BC; 4.1.8 O OCTANK Transit Gateway Route Table &#xAD6C;&#xC131;1 \]](../.gitbook/assets/4.2.9.ooctank_tgw_associate.png)

**3.US-WEST-2에서 정상적으로 Transit Gateway Route Table이 동작하는 지 확인합니다.**

\[VPC\] -\[ Transit Gateway\] - \[ Transit Gateway Route Table\]

![\[&#xADF8;&#xB9BC; 4.1.9 O OCTANK Transit Gateway Route Table &#xD655;&#xC778; \]](../.gitbook/assets/4.2.10.ooctank_tgw_check1.png)

![\[&#xADF8;&#xB9BC; 4.1.10 O OCTANK Transit Gateway Route Table &#xD655;&#xC778; \]](../.gitbook/assets/4.2.11.ooctank_tgw_check2.png)

**4. US-WEST-2 리전에 VPC EC2 인스턴스에서 네트워크 연결을 확인합니다.**

```text
aws configure --profile "profile name"
# aws profile switching 합니다.

aws ec2 describe-instances --query 'Reservations[].Instances[].[Tags[?Key==`Name`] | [0].Value, Placement.AvailabilityZone,InstanceId, InstanceType, ImageId,State.Name, PrivateIpAddress, PublicIpAddress ]' --output table
# instance id를 조회합니다.

aws ssm start-session --target "EC2 instanace id"
# Running 중인 인스턴스에 AWS SSM을 통해 접속합니다.


[ec2-user@ip-10-100-14-100 TGW_CF]$ chmod 755 ./pingshell.sh
chmod: changing permissions of ‘./pingshell.sh’: Operation not permitted
[ec2-user@ip-10-100-14-100 TGW_CF]$ sudo chmod 755 ./pingshell.sh
[ec2-user@ip-10-100-14-100 TGW_CF]$ ./pingshell.sh
Tue Mar  3 15:48:35 UTC 2020
SERVER www.aws.com is up
SERVER ITSVR-A is down
SERVER ITSVR-B is down
SERVER ASVR-A is down
SERVER ASVR-B is down
SERVER BSVR-A is down
SERVER BSVR-B is down
SERVER CSVR-A is down
SERVER CSVR-B is down
SERVER DSVR-A is down
SERVER DSVR-B is down
SERVER FSVR-A is down
SERVER FSVR-B is down
SERVER ISVR-A is down


```

US-WEST-2 VPC EC2 인스턴스는 자신의 VPC가 소유한 IGW, NAT G.W를 통해서 외부망 네트워크에 연결이 되지만, 다른 Region으로는 연결이 불가능합니다.

### 서로 다른 Account 환경에서 다른 Region Transit Gateway Peering 구성





